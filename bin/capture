#!/bin/sh

# A script to start capturing video from Raspberry Pi camera and
# output it to stdout.

set -e

[ -n "${CAPTURE_PASSWORD}" ] && grep -q "${CAPTURE_PASSWORD}"

# First, print headers (if present)
printf "%s" "$*"

if [ -n "${CAPTURE_FPS}" ]; then
	exec raspivid \
		--nopreview \
		--width "${CAPTURE_WIDTH:-640}" \
		--height "${CAPTURE_HEIGHT:-480}" \
		--vflip --hflip \
		--timeout 0 \
		--framerate "${CAPTURE_FPS}" \
		--vstab \
		-o -
else
	exec raspistill \
		--nopreview \
		--width "${CAPTURE_WIDTH:-2592}" \
		--height "${CAPTURE_HEIGHT:-1944}" \
		--vflip --hflip \
		--quality "${CAPTURE_QUALITY:-80}" \
		-o -
fi
